# دليل إدارة الأقسام والبرامج الأكاديمية

## نظرة عامة
تم إنشاء نظام متكامل لإدارة الأقسام الأكاديمية والبرامج الدراسية في قاعدة بيانات Supabase مع واجهة إدارة شاملة.

## هيكل قاعدة البيانات

### 1. جدول `academic_departments` (الأقسام الأكاديمية)
يحتوي على معلومات الأقسام الأكاديمية الرئيسية:
- `id`: معرف فريد للقسم
- `department_key`: مفتاح القسم (tech_science, admin_humanities, medical)
- `name_ar`: اسم القسم بالعربية
- `name_en`: اسم القسم بالإنجليزية
- `description_ar/en`: وصف القسم
- `icon_name`: اسم الأيقونة
- `icon_color`: لون الأيقونة
- `background_color`: لون الخلفية
- `display_order`: ترتيب العرض
- `is_active`: حالة النشاط
- `metadata`: بيانات إضافية (JSON)

### 2. جدول `dynamic_academic_programs` (البرامج الأكاديمية)
يحتوي على معلومات البرامج الدراسية:
- `id`: معرف فريد للبرنامج
- `department_id`: معرف القسم التابع له (Foreign Key)
- `program_key`: مفتاح البرنامج
- `title_ar/en`: عنوان البرنامج
- `description_ar/en`: وصف البرنامج
- البيانات الأخرى: المدة، الساعات المعتمدة، المناهج، إلخ.

### العلاقة بين الجداول
- علاقة **One-to-Many**: قسم واحد يحتوي على عدة برامج
- يتم الربط عبر `dynamic_academic_programs.department_id -> academic_departments.id`

## الأقسام الأكاديمية المتاحة

### 1. قسم العلوم التقنية والحاسوب
- **المفتاح**: `tech_science`
- **الأيقونة**: Laptop
- **اللون**: أزرق (#3B82F6)
- **البرامج**: تكنولوجيا المعلومات

### 2. قسم العلوم الإدارية والإنسانية
- **المفتاح**: `admin_humanities`
- **الأيقونة**: Briefcase
- **اللون**: برتقالي (#F59E0B)
- **البرامج**: إدارة الأعمال

### 3. قسم العلوم الطبية
- **المفتاح**: `medical`
- **الأيقونة**: Heart
- **اللون**: أحمر (#EF4444)
- **البرامج**: التمريض، الصيدلة، القبالة

## الملفات المهمة

### 1. Utilities
- `src/utils/seedAcademicDepartments.ts`: رفع البيانات الأولية للأقسام
- `src/utils/departmentDataSync.ts`: مزامنة البرامج مع الأقسام

### 2. Hooks
- `src/hooks/useAcademicDepartments.ts`: إدارة الأقسام (CRUD)
- `src/hooks/useDepartmentPrograms.ts`: جلب البرامج حسب القسم والإحصائيات

### 3. Components
- `src/components/admin/DepartmentsManagement.tsx`: إدارة الأقسام
- `src/components/admin/ProgramsManagement.tsx`: إدارة البرامج
- `src/components/admin/programs/DepartmentSelector.tsx`: اختيار القسم
- `src/components/admin/programs/StatisticsOverview.tsx`: عرض الإحصائيات

### 4. Pages
- `src/pages/admin/programs.tsx`: صفحة إدارة البرامج والأقسام
- `src/pages/DepartmentsIndex.tsx`: صفحة عرض الأقسام العامة

## كيفية الاستخدام

### 1. الوصول إلى لوحة التحكم
انتقل إلى: `/admin/programs`

### 2. عرض الإحصائيات
- إجمالي الأقسام
- إجمالي البرامج
- البرامج النشطة
- متوسط البرامج لكل قسم

### 3. إدارة الأقسام (تبويب "الأقسام الأكاديمية")
- **إضافة قسم جديد**: انقر على زر "إضافة قسم جديد"
- **تعديل قسم**: انقر على أيقونة التعديل في البطاقة
- **تفعيل/إلغاء تفعيل**: استخدم المفتاح في البطاقة
- **حذف قسم**: انقر على أيقونة الحذف (بعد التأكيد)

### 4. إدارة البرامج (تبويب "البرامج الأكاديمية")
- **إضافة برنامج**: اختر القسم التابع له من القائمة
- **تصفية البرامج**: حسب القسم
- **تعديل ونشر البرامج**

## التحميل التلقائي للبيانات
عند أول تحميل لصفحة `/admin/programs`:
- يتم تحميل بيانات الأقسام الثلاثة تلقائياً إلى قاعدة البيانات
- لا يتم تكرار البيانات الموجودة
- يتم عرض رسالة نجاح عند الإضافة

## المزامنة والتحقق

### مزامنة البرامج مع الأقسام
```typescript
import { syncProgramsWithDepartments } from '@/utils/departmentDataSync';

// مزامنة البرامج التي لا تحتوي على department_id
await syncProgramsWithDepartments();
```

### التحقق من سلامة البيانات
```typescript
import { validateDepartmentData } from '@/utils/departmentDataSync';

// التحقق من البرامج اليتيمة (بدون قسم)
const validation = await validateDepartmentData();
console.log(`عدد البرامج اليتيمة: ${validation.orphaned}`);
```

## إضافة قسم جديد مستقبلاً

### 1. في قاعدة البيانات
```sql
INSERT INTO academic_departments (
  department_key,
  name_ar,
  name_en,
  description_ar,
  description_en,
  icon_name,
  icon_color,
  background_color,
  display_order,
  is_active
) VALUES (
  'new_department_key',
  'اسم القسم بالعربية',
  'Department Name in English',
  'وصف القسم',
  'Department description',
  'IconName',
  '#COLOR',
  '#BGCOLOR',
  4,
  true
);
```

### 2. عبر لوحة التحكم
- اذهب إلى `/admin/programs`
- اختر تبويب "الأقسام الأكاديمية"
- انقر على "إضافة قسم جديد"
- املأ البيانات المطلوبة
- احفظ

## الأمان (RLS Policies)

### للأقسام:
- **القراءة**: متاحة للجميع (الأقسام النشطة فقط)
- **الكتابة**: المسؤولون فقط

### للبرامج:
- **القراءة**: متاحة للجميع (البرامج المنشورة والنشطة)
- **الكتابة**: المسؤولون فقط

## الميزات الإضافية

### 1. البحث والتصفية
- تصفية البرامج حسب القسم
- البحث في الأقسام

### 2. الإحصائيات
- عدد الأقسام والبرامج
- البرامج لكل قسم
- المتوسطات

### 3. التحقق التلقائي
- التحقق من وجود البيانات قبل الإضافة
- منع التكرار

### 4. الواجهة متعددة اللغات
- دعم العربية والإنجليزية
- واجهة RTL

## الملاحظات المهمة

1. ✅ يتم الحفاظ على البيانات الحالية
2. ✅ يتم الحفاظ على التصميم الحالي
3. ✅ النظام مرن ويسمح بإضافة أقسام جديدة
4. ✅ العلاقات بين الجداول محددة بشكل صحيح
5. ✅ الأمان محقق عبر RLS Policies

## الدعم والتطوير المستقبلي

### إمكانيات التوسع:
- إضافة أقسام فرعية
- ربط البرامج بالكليات
- إضافة تخصصات داخل البرامج
- نظام موافقات متعدد المستويات
- تقارير متقدمة

### الصيانة:
- مراجعة دورية للبيانات
- تحديث الإحصائيات
- نسخ احتياطي منتظم
